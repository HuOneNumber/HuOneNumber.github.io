<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="HTML,CSS,JavaScript">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="胡倚豪">
    
    <title>
        
            04-网络层：数据平面 |
        
        HuOneNumber | 个人博客
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/avatar.png">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/css/font-awesome.min.css">
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"zh-CN","path":"search.xml"};
    KEEP.theme_config = {"toc":{"enable":true,"number":false,"expand_all":true,"init_open":true},"style":{"primary_color":"#33FFCC","avatar":"/images/avatar.png","favicon":"/images/avatar.png","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":true,"scale":true},"first_screen":{"enable":true,"description":"慢慢来，深几度。。。","background_img":"/images/bg.svg"},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":true}}},"local_search":{"enable":true,"trigger":"auto","unescape":false,"preload":true},"code_copy":{"enable":true,"style":"mac"},"pjax":{"enable":true},"lazyload":{"enable":true},"version":"3.4.3"};
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 月前","year":"%s 年前"};
  </script>
<meta name="generator" content="Hexo 5.3.0"><link rel="alternate" href="/atom.xml" title="别着急，慢慢来" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fas fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                HuOneNumber | 个人博客
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                首页
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                归档
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                分类
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                标签
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                关于
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">首页</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">归档</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">分类</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">标签</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">关于</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">04-网络层：数据平面</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar.png">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">胡倚豪</span>
                        
                            <span class="author-label">Lv4</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;2021-05-29 17:14:21
    </span>
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a>&nbsp;
                    </li>
                
                    <li>
                        &gt; <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%EF%BC%9A%E8%87%AA%E9%A1%B6%E5%90%91%E4%B8%8B%E6%96%B9%E6%B3%95/">计算机网络：自顶向下方法</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/Computer-Network/">Computer Network</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>9.1k 字</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fas fa-clock"></i>&nbsp;<span>31 分钟</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <p>网络层能够被分解为两个相互作用的部分:</p>
<ul>
<li><p>网络层的数据平面功能，即网络层中每台路由器的功能，决定到路由器一条输入链路的数据报如何转发到该路由器的一条输出链路。</p>
</li>
<li><p>网络层的控制平面功能，即网络范围的逻辑，控制数据报沿着路径中路由器之间的路由方式。</p>
</li>
</ul>
<h2 id="4-1-网络层概述"><a href="#4-1-网络层概述" class="headerlink" title="4.1  网络层概述"></a>4.1  网络层概述</h2><h3 id="4-1-1-转发和路由选择：数据平面和控制平面"><a href="#4-1-1-转发和路由选择：数据平面和控制平面" class="headerlink" title="4.1.1   转发和路由选择：数据平面和控制平面"></a>4.1.1   转发和路由选择：数据平面和控制平面</h3><p>网络层两种重要的网络层功能：</p>
<ul>
<li><p>转发。在数据平面中用硬件来实现的唯一功能，当一个分组到达某路由器的一条输入链路时，该路由器必须将该分组移动到适当的输出链路，通常用硬件来实现。</p>
</li>
<li><p>路由选择。在网络层的控制平面中用软件来实现。当分组从发送方流向接收方时，决定这些分组所采用的路由或路径。计算这些路径的算法被称为路由选择算法。</p>
</li>
</ul>
<p>每台网络路由器中有一个转发表。路由器检查到达分组首部的一个或多个字段值，进而使用这些首部值在其转发表中索引，这些值对应存储在转发表项中的值，指出该分组将被转发的路由器的输出链路接口。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://i.loli.net/2021/05/30/jzcKxepV7Q1lX6w.png"
                      alt="image-20210530160723243"
                ></p>
<p>1，控制平面：传统的方法</p>
<p>运行在每台路由器中的路由选择算法决定了插入该路由器转发表的内容，路由选择算法之间通信，以计算出它的转发表的值。</p>
<p>2，控制平面：<code>SDN</code>方法<br>每台路由器都有一个路由选择组件相互通信。远程控制器计算和分发转发表以供每台路由器所使用。可能实现在具有高可靠性和冗余的远程数据中心中，并可能由<code>ISP</code>或某些第三方管理。路由器和远程控制器通过交换包含转发表和其他路由选择信息的报文通信。这种是软件定义网络（<code>SDN</code>）的本质，因为计算转发表并与路由器交互的控制器是用软件实现的，故网络是“软件定义”的。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://i.loli.net/2021/05/30/MZp75LIFhoGWET3.png"
                      alt="image-20210530163734572"
                ></p>
<h3 id="4-1-2-网络服务模型"><a href="#4-1-2-网络服务模型" class="headerlink" title="4.1.2   网络服务模型"></a>4.1.2   网络服务模型</h3><p>网络服务模型定义分组在发送与接收端系统之间的端到端运输特性。我们现在考虑网络层能提供的某些可能的服务。这些服务可能包括：</p>
<ul>
<li><p>确保交付。该服务确保分组将最终到达目的地。</p>
</li>
<li><p>具有时延上界的确保交付。该服务不仅确保分组的交付，而且在特定的主机到主机时延上界内交付。</p>
</li>
<li><p>有序分组交付。该服务确保分组以它们发送的顺序到达目的地。</p>
</li>
<li><p>确保最小带宽。只要发送主机以低于特定比特率的速率传输比特（作为分组的组成部分），则所有分组最终会交付到目的主机。</p>
</li>
<li><p>安全性。网络层能够在源加密所有数据报并在目的地解密这些分组，从而对所有运输层报文段提供机密性。</p>
</li>
</ul>
<p>实际上网络层传送的分组既不能保证以它们发送的顺序被接收，也不能保证它们最终交付；既不能保证端到端时延，也不能保证有最小的带宽。</p>
<h2 id="4-2-路由器工作原理"><a href="#4-2-路由器工作原理" class="headerlink" title="4.2   路由器工作原理"></a>4.2   路由器工作原理</h2><p>下图显示了一个通用路由器体系结构的总体视图，其中标识了一台路由器的4个组件。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://i.loli.net/2021/05/30/QXAsovZCjwxSTMd.png"
                      alt="image-20210530165651459"
                ></p>
<ul>
<li>输入端口。在路由器中执行终结入物理链路的物理层功能，显示在输入端口最左侧和输出端口最右侧的方框中。与位于入链路远端的数据链路层交互来执行数据链路层功能，显示在输入与输出端口中间的方框中。执行查找功能，这显示在输入端口最右侧的方框中。通过查询转发表决定路由器的输出端口，到达的分组通过路由器的交换结构转发到输出端口。控制分组（如携带路由选择协议信息的分组）从输入端口转发到路由选择处理器。这里的“端口”指的是路由器的物理输入和输出接口，不同于软件端口。</li>
<li>交换结构。交换结构将路由器的输入端口连接到它的输出端口。</li>
<li>输出端口。输出端口存储从交换结构接收的分组，并通过执行必要的链路层和物理层功能在输出链路上传输这些分组。当一条链路是双向的时，输出端口通常与该链路的输入端口成对出现在同一线路卡上。</li>
<li>路由选择处理器。在传统的路由器中，执行路由选择协议，维护路由选择表与关联链路状态信息，并为该路由器计算转发表。在<code>SDN</code>路由器中，负责与远程控制器通信，目的是接收由远程控制器计算的转发表项，并在该路由器的输入端口安装这些表项。路由选择处理器还执行网络管理功能。</li>
</ul>
<h3 id="4-2-1-输入端口处理和基于目的地转发"><a href="#4-2-1-输入端口处理和基于目的地转发" class="headerlink" title="4.2.1   输入端口处理和基于目的地转发"></a>4.2.1   输入端口处理和基于目的地转发</h3><p>输入端口的线路端接功能与链路层处理实现了用于各个输入链路的物理层和链路层。在输入端口中执行的查找是使用转发表来查找输出端口，使得到达的分组能经过交换结构转发到该输出端口。转发表是由路由选择处理器计算和更新的，或者接收来自远程<code>SDN</code>控制器的内容。转发表从路由选择处理器经过独立总线复制到线路卡。使用在每个输入端口的影子副本，转发决策能在每个输入端口本地做出，避免了集中式处理。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://i.loli.net/2021/05/30/GuE1hOiXeF9zRTt.png"
                      alt="image-20210530175102784"
                ></p>
<p>在32比特<code>IP</code>地址的情况下，针对每个目的地址有一个表项是不可行，而是路由器用分组目的地址的前缀与表中的表项进行匹配，如果存在一个匹配项，则路由器向与该匹配项相关联的链路转发分组。当有多个匹配时，该路由器使用最长前缀匹配规则，并向相关联的链路接口转发分组。表查找是简单的，但这种查找必须在纳秒级执行。因此，不仅必须要用硬件执行查找，而且需要对大型转发表使用快速查找算法。</p>
<table>
<thead>
<tr>
<th align="center">前缀匹配</th>
<th align="center">链路接口</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1001000 00010111 00010</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">11001000 00010111 000110000</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">11001000 00010111 00011</td>
<td align="center">2</td>
</tr>
<tr>
<td align="center">其他</td>
<td align="center">3</td>
</tr>
</tbody></table>
<p>一旦通过查找确定了某分组的输出端口，则该分组就能够发送进入交换结构。但如果来自其他输入端口的分组当前正在使用该交换结构，必须要在输入端口处排队，并等待稍后被及时调度以通过交换结构。</p>
<p>输入端口处理：</p>
<ol>
<li><p>物理层和链路层处理；</p>
</li>
<li><p>检查分组的版本号、检验和以及寿命字段，并且重写后两个字段；</p>
</li>
<li><p>更新用于网络管理的计数器（如接收到的<code>IP</code>数据报的数目）</p>
</li>
<li><p>根据转发表查找转发。</p>
</li>
</ol>
<p>在链路层交换机中，除了发送帧进入交换结构去往输出端口外，还要查找链路层目的地址，并采取几个动作:</p>
<ul>
<li>在防火墙中，首部匹配给定准则的分组可能被阻止转发。</li>
<li>在网络地址转换器（NAT）中，一个运输层端口号匹配某给定值的分组，在转发前其端口号将被重写。</li>
</ul>
<h3 id="4-2-2-交换"><a href="#4-2-2-交换" class="headerlink" title="4.2.2   交换"></a>4.2.2   交换</h3><p>交换结构位于一台路由器的核心部位，分组从一个输入端口交换（即转发）到一个输出端口中。交换可以用许多方式完成。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://i.loli.net/2021/05/30/vAwWIJcRXuFLjT3.png"
                      alt="image-20210530201524035"
                ></p>
<ul>
<li><p>经内存交换。输入端口与输出端口之间的交换是在CPU（路由选择处理器）的直接控制下完成的。一个分组到达一个输入端口时，该端口会先通过中断方式向路由选择处理器发出信号，于是该分组从输入端口处被复制到处理器内存中。路由选择处理器则从其首部中提取目的地址，在转发表中找出适当的输出端口，并将该分组复制到输出端口的缓存中。在这种情况下，不能同时转发两个分组，即使它们有不同的目的端口，因为经过共享系统总线一次仅能执行一个内存读/写。</p>
</li>
<li><p>经总线交换。输入端口经一根共享总线将分组直接传送到输出端口，不需要路由选择处理器的干预。让输入端口为分组预先计划一个交换机内部标签（首部）。该分组能由所有输出端口收到，但只有与该标签匹配的端口才能保存该分组，然后标签在输出端口被去除。因为其仅用于交换机内部来跨越总线，如果多个分组同时到达路由器，除了一个分组外所有其他分组必须等待，因为一次只有一个分组能够跨越总线，故路由器的交换带宽受总线速率的限制。</p>
</li>
<li><p>经互联网络交换。纵横式交换机就是一种由<code>2N</code>条总线组成的互联网络，它连接N个输入端口与N个输出端口，交叉点通过交换结构控制器（其逻辑是交换结构自身的一部分）能够开启和闭合。因此纵横式网络能够并行转发多个分组。纵横式交换机是非阻塞的，但如果来自两个不同输入端口的两个分组其目的地为相同的输出端口，则一个分组必须在输入端等待，因为在某个时刻经给定总线仅能够发送一个分组。</p>
</li>
</ul>
<h3 id="4-2-3-输出端口处理"><a href="#4-2-3-输出端口处理" class="headerlink" title="4.2.3   输出端口处理"></a>4.2.3   输出端口处理</h3><p>输出端口处理取出已经存放在输出端口内存中的分组并将其发送到输出链路上，包括选择和取出排队的分组进行传输，执行所需的链路层和物理层传输功能。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://i.loli.net/2021/05/30/Jj3EbPXG4ftpLT8.png"
                      alt="image-20210530203625367"
                ></p>
<h3 id="4-2-4-何处出现排队"><a href="#4-2-4-何处出现排队" class="headerlink" title="4.2.4   何处出现排队"></a>4.2.4   何处出现排队</h3><p>排队的位置和程度将取决于流量负载、交换结构的相对速率和线路速率。随着这些队列的增长，路由器的缓存空间最终将会耗尽，并且当无内存可用于存储到达的分组时将会出现丢包。</p>
<h4 id="4-2-4-1-输入排队"><a href="#4-2-4-1-输入排队" class="headerlink" title="4.2.4.1   输入排队"></a>4.2.4.1   输入排队</h4><p>如果交换结构相对于输入线路速度不能快得使所有到达分组无时延地通过它传送，在输入端口将出现分组排队，因为到达的分组必须加入输入端口队列中，以等待通过交换结构传送到输出端口。</p>
<p>输入排队交换机中的线路前部（<code>HOL</code>）阻塞：即在一个输入队列中排队的分组必须等待通过交换结构发送（即使输出端口是空闲的），因为它被位于线路前部的另一个分组所阻塞。由于<code>HOL</code>阻塞，只要输入链路上的分组到达速率通常达到其容量的58%，输入队列长度就将无限制地增大。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://i.loli.net/2021/05/30/7VmygZIaSBXYPjR.png"
                      alt="image-20210530204312111"
                ></p>
<h4 id="4-2-4-2-输出排队"><a href="#4-2-4-2-输出排队" class="headerlink" title="4.2.4.2   输出排队"></a>4.2.4.2   输出排队</h4><p>假定输入与输出线路速度是相同的，均为R<sub>line</sub>（单位为每秒分组数），并且有N个输入端口和N个输出端口。假设所有分组具有相同的固定长度，分组以同步的方式到达输入端口。定义交换结构传送速率R<sub>switch</sub>为从输入端口到输出端口能够移动分组的速率。</p>
<p>如果R<sub>switch</sub>比R<sub>line</sub>快N倍，并且到达N个输入端口的每个端口的分组，其目的地是相同的输出端口。在这种情况下，能够在输出端口形成排队。输出端口的<strong>分组调度</strong>在这些排队分组中选择一个分组来传输。</p>
<p>如果通过路由器缓存来吸收流量负载的波动，用于缓存长度的方法是，缓存数量（B）应当等于平均往返时延（<code>RTT</code>）乘以链路的容量（C）。这个结果是基于相对少量的TCP流的排队动态性分析得到的。当有大量的TCP流（N条）流过一条链路时，缓存所需要的数量是B=<code>RTT*C/N</code>，对于通常有大量流经过的大型主干路由器链路，N的值可能非常大，所需的缓存长度的减小相当明显。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://i.loli.net/2021/05/30/JxMiDgATtvF6UHL.png"
                      alt="image-20210530212818102"
                ></p>
<h3 id="4-2-5-分组调度"><a href="#4-2-5-分组调度" class="headerlink" title="4.2.5   分组调度"></a>4.2.5   分组调度</h3><h4 id="4-2-5-1-先进先出"><a href="#4-2-5-1-先进先出" class="headerlink" title="4.2.5.1   先进先出"></a>4.2.5.1   先进先出</h4><p>FIFO调度规则按照分组到达输出链路队列的相同次序来选择分组在链路上传输。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://i.loli.net/2021/05/30/d8XfOmQwTCNlLSJ.png"
                      alt="image-20210530222248203"
                ></p>
<h4 id="4-2-5-2-优先权排队"><a href="#4-2-5-2-优先权排队" class="headerlink" title="4.2.5.2   优先权排队"></a>4.2.5.2   优先权排队</h4><p>到达输出链路的分组被分类放入输出队列中的优先权类。在实践中，网络操作员可以配置一个队列，这样携带网络管理信息的分组（例如由源或目的<code>TCP/UDP</code>端口号所标识）获得超过用户流量的优先权；此外，基于<code>IP</code>的实时话音分组可能获得超过非实时流量（如<code>SMTP</code>或<code>IMAP</code>电子邮件分组）的优先权。每个优先权类通常都有自己的队列。当选择一个分组传输时，优先权排队规则将从队列为非空（也就是有分组等待传输）的最高优先权类中传输一个分组。在同一优先权类的分组之间的选通常以FIFO方式完成。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://i.loli.net/2021/05/30/vC6oiAL8jKUwkrD.png"
                      alt="image-20210530222444141"
                ></p>
<h4 id="4-2-5-3-循环和加权公平排队"><a href="#4-2-5-3-循环和加权公平排队" class="headerlink" title="4.2.5.3   循环和加权公平排队"></a>4.2.5.3   循环和加权公平排队</h4><p>在循环排队规则下，分组像使用优先权排队那样被分类。然而，在类之间不存在严格的服务优先权，循环调度器在这些类之间轮流提供服务。当寻找给定类的分组没有找到时，保持工作的循环规则将立即检查循环序列中的下一个类。</p>
<p>加权公平排队（<code>WFQ</code>）规则：到达的分组被分类并在合适的每个类的等待区域排队。与使用循环调度一样，<code>WFQ</code>调度器也以循环的方式为各个类提供服务，在发现一个空的类队列时，它立即移向服务序列中的下一个类。</p>
<p><code>WFQ</code>和循环排队的不同之处在于，每个类在任何时间间隔内可能收到不同数量的服务。每个类i被分配一个权w<sub>i</sub>，在类i有分组要发送的任何时间间隔中，第i类将确保接收到的服务部分等于w<sub>i</sub>/（Σw<sub>j</sub>），分母中的和是计算所有有分组排队等待传输的类别得到的。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://i.loli.net/2021/05/30/vVijo7REu46pAyL.png"
                      alt="image-20210530214714532"
                ></p>
<h2 id="4-3-网际协议：IPv4、寻址、IPv6及其他"><a href="#4-3-网际协议：IPv4、寻址、IPv6及其他" class="headerlink" title="4.3   网际协议：IPv4、寻址、IPv6及其他"></a>4.3   网际协议：<code>IPv4</code>、寻址、<code>IPv6</code>及其他</h2><h3 id="4-3-1-IPv4数据报格式"><a href="#4-3-1-IPv4数据报格式" class="headerlink" title="4.3.1   IPv4数据报格式"></a>4.3.1   <code>IPv4</code>数据报格式</h3><p>网络层分组被称为数据报，<code>IPv4</code>数据报格式如下图所示。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://i.loli.net/2021/05/31/Idq7yVKabv3WCpD.png"
                      alt="image-20210531163929050"
                ></p>
<p><code>IPv4</code>数据报中的关键字段如下：</p>
<ul>
<li>版本（号）。这4比特规定了数据报的<code>IP</code>协议版本。通过查看版本号，路由器能够确定如何解释<code>IP</code>数据报的剩余部分。不同的<code>IP</code>版本使用不同的数据报格式。</li>
<li>首部长度。因为一个<code>IPv4</code>数据报可包含一些可变数量的选项，故需要用这4比特来确定<code>IP</code>数据报中载荷实际开始的地方。大多数<code>IP</code>数据报不包含选项，所以一般<code>IP</code>数据报具有20字节的首部。</li>
<li>服务类型（<code>TOS</code>）。以便使不同类型的<code>IP</code>数据报能相互区别开来。例如，将实时数据报与非实时流量区分开。</li>
<li>数据报长度。这是<code>IP</code>数据报的总长度（首部加上数据），以字节计。该长度使得<code>IP</code>数据报能容纳最大长度以太网帧的载荷字段。</li>
<li>标识、标志、片偏移。这三个字段与<code>IP</code>分片有关，<code>IPv6</code>不允许在路由器上对分组分片。</li>
<li>寿命（<code>TTL</code>）。用来确保数据报不会永远在网络中循环。每当一台路由器处理数据报时，该字段的值减1，当减为0，则该数据报必须丢弃。</li>
<li>协议。指示了<code>IP</code>数据报的数据部分应交给哪个特定的运输层协议，通常仅当一个<code>IP</code>数据报到达其最终目的地时才会有用。例如，值为6表明数据部分要交给<code>TCP</code>，值为17表明数据要交给<code>UDP</code>。</li>
<li>首部检验和。用于帮助路由器检测收到的<code>IP</code>数据报中的比特错误。一般会丢弃检测出错误的数据报。在每台路由器上必须重新计算检验和并再次存放到原处，因为TTL字段以及可能的选项字段会改变。重复检测有几种原因：<code>IP</code>层只对<code>IP</code>首部计算了检验和，而<code>TCP/UDP</code>检验和是对整个报文段进行。2. <code>TCP/UDP</code>与<code>IP</code>不一定都必须属于同一个协议栈。</li>
<li>源和目的<code>IP</code>地址。当某源生成一个数据报时，插入它的<code>IP</code>地址，并通过<code>DNS</code>查找插入目的<code>IP</code>地址。</li>
<li>选项。允许<code>IP</code>首部被扩展，在<code>IPv6</code>首部中已去掉了<code>IP</code>选项。</li>
<li>数据（有效载荷）。在大多数情况下，包含要交付给目的地的运输层报文段（<code>TCP或UDP</code>），也可承载其他类型的数据，如<code>ICMP</code>报文。</li>
</ul>
<h3 id="4-3-2-IPv4数据报分片"><a href="#4-3-2-IPv4数据报分片" class="headerlink" title="4.3.2   IPv4数据报分片"></a>4.3.2   <code>IPv4</code>数据报分片</h3><p>一个链路层帧能承载的最大数据量叫作最大传送单元（<code>MTU</code>）。<code>MTU</code>限制着<code>IP</code>数据报的长度，而且每种协议可能具有不同的<code>MTU</code>。当<code>MTU</code>比该<code>IP</code>数据报的长度要小时，解决方法是将<code>IP</code>数据报中的数据分片成两个或更多个较小的<code>IP</code>数据报(<strong>片</strong>)，用单独的链路层帧封装这些较小的<code>IP</code>数据报，然后通过输出链路发送这些帧。</p>
<p>在端系统中重新组装数据报的，而不是网络路由器，因为这会影响路由器的性能。<code>IPv4</code>将标识、标志和片偏移字段放在<code>IP</code>数据报首部中。</p>
<ul>
<li>发送主机在为数据报设置源和目的地址的同时贴上标识号，发送的每个数据报的标识号加1，当某路由器需要对一个数据报分片时，形成的每个片具有初始数据报的源地址、目的地址与标识号。当目的主机收到一系列数据报时，检查数据报的标识号以确定哪些数据报是同一数据报的片。</li>
<li>由于<code>IP</code>是一种不可靠的服务，最后一个片的标志比特被设为0，而所有其他片的标志比特被设为1，让目的主机确定是否收到初始数据报的最后一个片。</li>
<li>使用偏移字段指定该片在初始<code>IP</code>数据报的位置，让目的主机确定是否丢失了一个片且能按正确的顺序重新组装片。</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://i.loli.net/2021/05/31/vqZXIMJg6LC1ylw.png"
                      alt="image-20210531170820139"
                ></p>
<h3 id="4-3-3-IPv4编址"><a href="#4-3-3-IPv4编址" class="headerlink" title="4.3.3   IPv4编址"></a>4.3.3   <code>IPv4</code>编址</h3><p>主机与路由器连入网络的方法：一台主机通常只有一条链路连接到网络。主机与物理链路之间的边界叫作接口。路由器必须拥有多条链路与它连接，它们之间的边界也叫作接口。因为每台主机与路由器都能发送和接收<code>IP</code>数据报，因此每台主机和路由器接口拥有自己的<code>IP</code>地址，都是全球唯一的（在NAT后面的接口除外）。因此，一个<code>IP</code>地址与一个接口相关联，而不是与包括该接口的主机或路由器相关联。这些地址不能随意地自由选择，一个接口的<code>IP</code>地址的一部分需要由其连接的子网来决定。</p>
<p>每个<code>IP</code>地址长度为32比特，按点分十进制记法书写，即地址中的每个字节用它的十进制形式书写，各字节间以句点隔开。因此，地址193.32.216.9的二进制记法是：11000001 00100000 11011000 00001001</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://i.loli.net/2021/05/31/uX3zNJHEhFMmDVg.png"
                      alt="image-20210531200408798"
                ></p>
<p>互联这3个主机接口与1个路由器接口的网络形成一个子网。<code>IP</code>编址为这个子网分配一个地址223.1.1.0/24，其中的<code>/24</code>记法，称为子网掩码，指示最左侧24比特定义了子网地址。任何其他要连到223.1.1.0/24网络的主机都要求其地址具有<code>223.1.1.xxx</code>形式。</p>
<p>一个子网的<code>IP</code>定义并不局限于连接多台主机到一个路由器接口的以太网段。对于一个路由器和主机的通用互联系统，分开主机和路由器的每个接口，产生几个隔离的网络岛，使用接口端接这些隔离的网络的端点。这些隔离的网络中的每一个都叫作一个子网。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://i.loli.net/2021/05/31/GiJ1wOPA5t6Yobz.png"
                      alt="image-20210531204945902"
                ></p>
<p>原则上，不同的子网具有完全不同的子网地址。然而在实践中，它们的子网地址经常有许多共同之处。因特网的地址分配策略被称为无类别域间路由选择（<code>CIDR</code>），当使用子网寻址时，<code>IP</code>地址被划分为两部分<code>a.b.c.d/x</code>，其中<code>x</code>指示了地址的第一部分中的比特数，这构成了<code>IP</code>地址的网络部分，被称为该地址的前缀。一个组织通常被分配具有相同前缀的一段地址，该组织内部的设备的<code>IP</code>地址将共享共同的前缀。</p>
<p>一个地址的剩余<code>32-x</code>比特可认为是用于区分该组织内部设备的，当该组织内部的路由器转发分组时，才会考虑这些比特。这些较低阶比特可能（或可能不）具有另外的子网结构，如前面所讨论的那样。例如，某<code>CIDR</code>化的地址<code>a.b.c.d/21</code>的前21比特定义了该组织的网络前缀，它对该组织中所有主机的<code>IP</code>地址来说是共同的。其余的11比特标识了该组织内的主机。该组织的内部结构可以采用这样的方式，使用最右边的11比特在该组织中划分子网，例如，<code>a.b.c.d/24</code>可能表示该组织内的特定子网。</p>
<p>在<code>CIDR</code>被采用之前，<code>IP</code>地址的网络部分被限制为长度为8、16或24比特，它们的子网地址的子网分别被称为A、BC类网络，这是一种称为分类编址的编址方案。但对于一个组织来说，不同类的子网可能不够分配或者剩余太多导致浪费。</p>
<p><code>IP</code>广播地址255.255.255.255，当一台主机发出一个目的地址为255.255.255.255 数据报时，该报文会交付给同一个网络中的所有主机。路由器也可能会向邻近的子网转发该报文。</p>
<h4 id="4-3-3-1-获取组织地址块"><a href="#4-3-3-1-获取组织地址块" class="headerlink" title="4.3.3.1   获取组织地址块"></a>4.3.3.1   获取组织地址块</h4><p>可以从一个<code>ISP</code>获取一组地址。例如，该<code>ISP</code>已被分配了地址块200.23.16.0/20，可以依次将该地址块分成8个长度相等的连续地址块，为本<code>ISP</code>支持的最多达8个组织中的一个分配这些地址块中的一块，如下所示。</p>
<p><code>ISP</code>的地址块   200.23.16.0/20       <u>11001000 00010111 0001</u>0000 00000000</p>
<p>组织0                200.23.16.0/23       <u>11001000 00010111 0001000</u>0 00000000</p>
<p>组织1                200.23.18.0/23       <u>11001000 00010111 0001001</u>0 00000000</p>
<p>组织2                200.23.20.0/23       <u>11001000 00010111 0001010</u>0 00000000<br>…<br>组织7                200.23.30.0/23       <u>11001000 00010111 0001111</u>0 000000000</p>
<p>通常由因特网名字和编号分配机构（<code>ICANN</code>）管理<code>IP</code>地址空间并向各<code>ISP</code>和其他组织分配地址块，并且管理<code>DNS</code>根服务器、分配域名与解决域名纷争。</p>
<h4 id="4-3-3-2-获取主机地址：动态主机配置协议"><a href="#4-3-3-2-获取主机地址：动态主机配置协议" class="headerlink" title="4.3.3.2   获取主机地址：动态主机配置协议"></a>4.3.3.2   获取主机地址：动态主机配置协议</h4><p>某组织一旦获得了一块地址，就可为本组织内的主机与路由器接口逐个分配<code>IP</code>地址。系统管理员通常远程通过网络管理工具进行手工配置<code>IP</code>地址。但是这项任务目前更多的是使用动态主机配置协议（<code>DHCP</code>）来完成。</p>
<p><code>DHCP</code>允许主机自动获取（被分配）一个<code>IP</code>地址，网络管理员能够配置<code>DHCP</code>，以使某给定主机每次与网络连接时能得到一个相同的<code>IP</code>地址，或者某主机将被分配一个临时的<code>IP</code>地址，每次与网络连接时该地址可能不同。<code>DHCP</code>还允许一台主机得知其他信息，例如它的子网掩码、它的第一跳路由器地址（默认网关）与它的本地<code>DNS</code>服务器的地址。</p>
<p><code>DHCP</code>是一个客户-服务器协议。客户通常是新到达的主机，它要获得包括自身使用的<code>IP</code>地址在内的网络配置信息。在最简单场合下，每个子网将具有一台<code>DHCP</code>服务器，否则需要一个<code>DHCP</code>中继代理（通常是一台路由器），这个代理知道用于该网络的<code>DHCP</code>服务器的地址。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://i.loli.net/2021/06/01/ewsgr6NcSJY7IWx.png"
                      alt="image-20210601142329609"
                ></p>
<p>对于一台新到达的主机而言，针对图4-23所示的网络设置，<code>DHCP</code>协议是一个4个步骤的过程，<code>yiaddr</code>指示分配给该新到达客户的地址。</p>
<ol>
<li><p><code>DHCP</code>服务器发现。一台新到达的主机通过使用<code>DHCP</code>发现报文找到一个要与其交互的<code>DHCP</code>服务器。客户在<code>UDP</code>分组中向端口67发送该发现报文，<code>UDP</code>分组封装在一个<code>IP</code>数据报中，使用广播目的地址255.25.255.255且使用源<code>IP</code>地址0.0.0.0。将<code>IP</code>数据报传递给链路层，链路层将帧广播到所有与该子网连接的节点。</p>
</li>
<li><p><code>DHCP</code>服务器提供。<code>DHCP</code>服务器收到一个<code>DHCP</code>发现报文时，用<code>DHCP</code>提供报文做出响应，该报文仍然使用<code>IP</code>广播地址255.255.255.255向该子网的所有节点广播。<code>DHCP</code>提供报文包含有收到的发现报文的事务ID、向客户推荐的<code>IP</code>地址、网络掩码以及<code>IP</code>地址租用期，即<code>IP</code>地址有效的时间量。服务器租用期通常设置为几小时或几天。</p>
</li>
<li><p><code>DHCP</code>请求。新到达的客户从一个或多个服务器提供中选择一个，因为在子网中可能存在几个<code>DHCP</code>服务器。并向选中的服务器用<code>DHCP</code>请求报文进行响应，回显配置的参数。</p>
</li>
<li><p><code>DHCP</code> <code>ACK</code>，服务器用<code>DHCP ACK</code>报文对<code>DHCP</code>请求报文进行响应，证实所要求的参数，客户收到<code>DHCP ACK</code>后，交互便完成了，该客户能够在租用期内使用<code>DHCP</code>分配的<code>IP</code>地址。</p>
</li>
</ol>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://i.loli.net/2021/06/01/845azqFHWxjSoXZ.png"
                      alt="image-20210601143057709"
                ></p>
<h3 id="4-3-4-网络地址转换"><a href="#4-3-4-网络地址转换" class="headerlink" title="4.3.4   网络地址转换"></a>4.3.4   网络地址转换</h3><p>当子网<code>IP</code>地址不够使用需要再分配一块较大的地址，但<code>ISP</code>已经分配过一块连续地址时，通常使用网络地址转换（<code>NAT</code>）解决。</p>
<p>下图所有4个接口都具有相同的网络地址，这些地址用于家庭网络等专用网络或具有专用地址的地域，其地址仅对该网络中的设备有意义的网络。然转发到家庭网络之外的分组不能使用这些地址作为源地址，或目的地址。从本质上讲，<code>NAT</code>使能路由器对外界隐藏了专用网络的细节。所有离开<code>NAT</code>路由器的报文都拥有一个源<code>IP</code>地址，且所有进入专用网络的报文都拥有同一个目的<code>IP</code>地址。NAT路由器上的NAT转换表，用于重写首部<code>IP</code>地址和端口号。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://i.loli.net/2021/06/01/B42lsTrHRn3WOLx.png"
                      alt="image-20210601144713039"
                ></p>
<h3 id="4-3-5-IPv6"><a href="#4-3-5-IPv6" class="headerlink" title="4.3.5   IPv6"></a>4.3.5   <code>IPv6</code></h3><h4 id="4-3-5-1-IPv6数据报格式"><a href="#4-3-5-1-IPv6数据报格式" class="headerlink" title="4.3.5.1   IPv6数据报格式"></a>4.3.5.1   <code>IPv6</code>数据报格式</h4><p><code>IPv6</code>数据报的格式如图4-26所示。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://i.loli.net/2021/06/01/vaPZckVNQ45pmJC.png"
                      alt="image-20210601154805112"
                ></p>
<ul>
<li>版本。用于标识<code>IP</code>版本号。<code>IPv6</code>将该字段值设为6，设置为4并不能创建一个合法的<code>IPv4</code>数据报。</li>
<li>流量类型。与<code>IPv4</code>的<code>TOS</code>字段的含义相似。</li>
<li>流标签。该20比特的字段用于标识一条数据报的流，是发送方要求进行特殊处理的流，对一条流中的某些数据报给出优先权。</li>
<li>有效载荷长度。一个无符号整数，给出<code>IPv6</code>数据报中跟在定长的40字节数据报首部后面的字节数量。</li>
<li>下一个首部。与<code>IPv4</code>首部中协议字段相同。</li>
<li>跳限制。转发数据报的每台路由器将对该字段的内容减1。如果跳限制计数达到0，则该数据报将被丢弃。</li>
<li>源地址和目的地址。128比特地址，确保不会用尽。除了单播与多播地址以外还有任播地址，这种地址可以使数据报交付给一组主机中的任意一个。</li>
<li>数据。数据报到达目的地时，从<code>IP</code>数据报中移出，并交给在下一个首部字段中指定的协议处理。</li>
</ul>
<p>在<code>IPv4</code>数据报中出现的几个字段在<code>IPv6</code>数据报中已不复存在：</p>
<ul>
<li><p>分片与重新组装，这加快了网络中的<code>IP</code>转发速度。如果路由器收到的<code>IPv6</code>数据报太大不能转发到出链路上，只需丢掉该数据报，并向发送方发回<code>ICMP</code>差错报文，发送方再使用较小长度的<code>IP</code>数据报重发数据。</p>
</li>
<li><p>首部检验和。</p>
</li>
<li><p>选项。但它可能出现在<code>IPv6</code>首部中下一个首部。</p>
</li>
</ul>
<h4 id="4-3-5-2-从IPv4到IPv6的迁移"><a href="#4-3-5-2-从IPv4到IPv6的迁移" class="headerlink" title="4.3.5.2   从IPv4到IPv6的迁移"></a>4.3.5.2   从IPv4到IPv6的迁移</h4><p>虽然<code>IPv6</code>使能系统可做成向后兼容，即能发送、路由和接收<code>IPv4</code>数据报，但已部署的具有<code>IPv4</code>能力的系统却不能够处理<code>IPv6</code>数据报。</p>
<p>在实践中广泛采用的方法包括建隧道。基本思想如下：假定两个<code>IPv6</code>节点使用<code>IPv6</code>数据报进行交互，两台中间<code>IPv4</code>路由器的集合称为一个隧道。在隧道发送端的<code>IPv6</code>节点B可将整个<code>IPv6</code>数据报放到一个<code>IPv4</code>数据报的数据字段中，并将该<code>IPv4</code>数据报的地址设为指向隧道接收端的<code>IPv6</code>节点E，隧道中的中间<code>IPv4</code>路由器在它们之间为该数据报提供路由，就像对待<code>IPv4</code>数据报一样。隧道接收端的<code>IPv6</code>节点最终收到该<code>IPv4</code>数据报（它是该<code>IPv4</code>数据报的目的地），并通过观察在<code>IPv4</code>数据报中的协议号字段是41，从而确定该<code>IPv4</code>数据报含有一个<code>IPv6</code>数据报并取出，然后再为该<code>IPv6</code>数据报提供路由。    </p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://i.loli.net/2021/06/01/P87aohrsYiACD3M.png"
                      alt="image-20210601161524579"
                ></p>
<h2 id="4-4-通用转发和SDN"><a href="#4-4-通用转发和SDN" class="headerlink" title="4.4  通用转发和SDN"></a>4.4  通用转发和<code>SDN</code></h2><p>路由器的转发决定传统上仅仅基于分组的目的地址。目的地转发的特征总结为两个步骤：查找目的<code>IP</code>地址（“匹配”），将分组发送到有特定输出端口的交换结构（“动作”）。</p>
<p>然而随着中间盒的剧增，出现一种能提供多种网络层功能以及某些链路层功能的通用“匹配加动作”范式：对协议栈的多个首部字段进行“匹配”，这些首部字段是与不同层次的不同协议相关联的。“动作”包括：</p>
<ul>
<li>将分组转发到一个或多个输出端口，就像在基于目的地转发中一样；</li>
<li>跨越多个通向服务的离开接口进行负载均衡分组，就像在负载均衡中一样；</li>
<li>重写首部值，就像在NAT中一样；</li>
<li>有意识地阻挡/丢弃某个分组，就像在防火墙中一样；</li>
<li>为进一步处理和动作而向某个特定的服务器发送一个分组，就像在深度分组检测（<code>DPI</code>）一样。</li>
</ul>
<p>因为在通用转发中，能够使用网络层和/或链路层源和目的地址做出转发决定，所以转发设备用通用的描述称为分组交换机，而不仅仅是路由器或交换机。位于每台分组交换机中的一张匹配加动作表，虽然在各台分组交换机中的控制组件可以相互作用，但实践中是远程控制器计算、安装和更新这些表。对通用转发将主要考虑<code>OpenFlow 1.0</code>，该标准以特别清晰和简明的方式引入了关键的<code>SDN</code>抽象和功能。匹配加动作转发表在<code>OpenFlow</code>中称为流表（flow table），它的每个表项包括：</p>
<ul>
<li>首部字段值的集合，入分组将与之匹配。匹配不上流表项的分组将被丢弃或发送到远程控制器做更多处理。在实践中，为了性能或成本原因，一个流表可以由多个流表实现。</li>
<li>计数器集合。当分组与流表项匹配时更新计数器，可以包括已经与该表项匹配的分组数量，以及自从该表项上次更新以来的时间。</li>
<li>当分组匹配流表项时所采取的动作集合。包括将分组转发到给定的输出端口，丢弃该分组、复制该分组和将它们发送到多个输出端口，和/或重写所选的首部字段。</li>
</ul>
<p>流表本质上是一个<code>API</code>，通过这种抽象每台分组交换机的行为能被编程，通过在网络分组交换机的集合中适当地编程/配置这些表，网络范围的行为能被类似地编程。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://i.loli.net/2021/06/01/ukeXwxVn7SGiHZ6.png"
                      alt="image-20210601164513374"
                ></p>
<h3 id="4-4-1-匹配"><a href="#4-4-1-匹配" class="headerlink" title="4.4.1   匹配"></a>4.4.1   匹配</h3><p><code>Openflow</code>的匹配抽象允许对来自三个层次的协议首部所选择的字段进行匹配。入端口是指分组交换机上接收分组的输入端口，入端口ID能被<code>OpenFlow 1.0</code>中的匹配加动作规则所匹配。<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://i.loli.net/2021/06/01/JaIsBOQNvHhGRSK.png"
                      alt="image-20210601185825435"
                >流表项也可以有通配符。例如，在一个流表中<code>IP</code>地址<code>128.119.*.*</code>。每个流表项也具有相应的优先权，如果一个分组匹配多个流表项，选定的匹配和对应的动作将是其中有最高优先权的那个。</p>
<h3 id="4-4-2-动作"><a href="#4-4-2-动作" class="headerlink" title="4.4.2   动作"></a>4.4.2   动作</h3><p>每个流表项都有零个或多个动作列表，这些动作决定了应用于与流表项匹配的分组的处理。如果有多个动作，它们以在表中规定的次序执行。其中最为重要的动作可能是：</p>
<ul>
<li>转发。入分组可以转发到一个特定的物理输出端口，广播到所有端口（分组到达的端口除外），或对所选的端口集合进行多播。该分组可能被封装并发送到用于该设备的远程控制器。该控制器则可能对该分组采取某些动作，包括安装新的流表项，以及可能将该分组返回给该设备以在更新的流表规则集合下进行转发。</li>
<li>丢弃。没有动作的流表项表明某个匹配的分组应当被丢弃。</li>
<li>修改字段。在分组被转发到所选的输出端口之前，分组首部10个字段（除<code>IP</code>协议字段)中的值都可以重写。</li>
</ul>

        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    <ul>
        <li>本文标题：04-网络层：数据平面</li>
        <li>本文作者：胡倚豪</li>
        <li>创建时间：2021-05-29 17:14:21</li>
        <li>
            本文链接：huonenumber.github.io/2021/05/29/note/Computer Networking/04-网络层：数据平面/
        </li>
        <li>
            版权声明：本博客所有文章除特别声明外，均采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> 许可协议。转载请注明出处！
        </li>
    </ul>
</div>

            </div>
        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/2021/06/02/note/Computer%20Networking/05-%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%9A%E6%8E%A7%E5%88%B6%E5%B9%B3%E9%9D%A2/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">05-网络层：控制平面</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2021/05/19/note/Computer%20Networking/03-%E8%BF%90%E8%BE%93%E5%B1%82/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">03-运输层</span>
                                <span class="post-nav-item">下一篇</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
            <div class="comment-container">
                <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fas fa-comments">&nbsp;评论</i>
    </div>
    

        
            
    <div class="valine-container">
        <script data-pjax
                src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script>
        <div id="vcomments"></div>
        <script data-pjax>
            function loadValine() {
                new Valine({
                    el: '#vcomments',
                    appId: 'oRtabIpmHUsCjAVoocAuRiR6-gzGzoHsz',
                    appKey: '8MQB6tSReJAP6eYmI5OGVpTo',
                    meta: ['nick', 'mail', 'link'],
                    avatar: 'wavatar',
                    enableQQ: true,
                    placeholder: '请尽情吐槽吧~',
                    lang: 'zh-CN'.toLowerCase()
                });

                function getAuthor(language) {
                    switch (language) {
                        case 'en':
                            return 'Author';
                        case 'zh-CN':
                            return '博主';
                        default:
                            return 'Master';
                    }
                }

                // Add "Author" identify
                const getValineDomTimer = setInterval(() => {
                    const vcards = document.querySelectorAll('#vcomments .vcards .vcard');
                    if (vcards.length > 0) {
                        let author = '胡倚豪';

                        if (author) {
                            for (let vcard of vcards) {
                                const vnick_dom = vcard.querySelector('.vhead .vnick');
                                const vnick = vnick_dom.innerHTML;
                                if (vnick === author) {
                                    vnick_dom.innerHTML = `${vnick} <span class="author">${getAuthor(KEEP.hexo_config.language)}</span>`
                                }
                            }
                        }
                        clearInterval(getValineDomTimer);
                    } else {
                        clearInterval(getValineDomTimer);
                    }
                }, 2000);
            }

            if ('true') {
                const loadValineTimeout = setTimeout(() => {
                    loadValine();
                    clearTimeout(loadValineTimeout);
                }, 1000);
            } else {
                window.addEventListener('DOMContentLoaded', loadValine);
            }
        </script>
    </div>



        
    
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2020</span>&nbsp;-&nbsp;
            
            2021&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">胡倚豪</a>
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        访问人数&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        总访问量&nbsp;<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.3</a>
        </div>
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fas fa-comment"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        
            <li class="tools-item rss flex-center">
                <a class="flex-center"
                   href="/atom.xml"
                   target="_blank"
                >
                    <i class="fas fa-rss"></i>
                </a>
            </li>
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-%E7%BD%91%E7%BB%9C%E5%B1%82%E6%A6%82%E8%BF%B0"><span class="nav-text">4.1  网络层概述</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-1-%E8%BD%AC%E5%8F%91%E5%92%8C%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%EF%BC%9A%E6%95%B0%E6%8D%AE%E5%B9%B3%E9%9D%A2%E5%92%8C%E6%8E%A7%E5%88%B6%E5%B9%B3%E9%9D%A2"><span class="nav-text">4.1.1   转发和路由选择：数据平面和控制平面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-2-%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E6%A8%A1%E5%9E%8B"><span class="nav-text">4.1.2   网络服务模型</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-%E8%B7%AF%E7%94%B1%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-text">4.2   路由器工作原理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-1-%E8%BE%93%E5%85%A5%E7%AB%AF%E5%8F%A3%E5%A4%84%E7%90%86%E5%92%8C%E5%9F%BA%E4%BA%8E%E7%9B%AE%E7%9A%84%E5%9C%B0%E8%BD%AC%E5%8F%91"><span class="nav-text">4.2.1   输入端口处理和基于目的地转发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-2-%E4%BA%A4%E6%8D%A2"><span class="nav-text">4.2.2   交换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-3-%E8%BE%93%E5%87%BA%E7%AB%AF%E5%8F%A3%E5%A4%84%E7%90%86"><span class="nav-text">4.2.3   输出端口处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-4-%E4%BD%95%E5%A4%84%E5%87%BA%E7%8E%B0%E6%8E%92%E9%98%9F"><span class="nav-text">4.2.4   何处出现排队</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-4-1-%E8%BE%93%E5%85%A5%E6%8E%92%E9%98%9F"><span class="nav-text">4.2.4.1   输入排队</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-4-2-%E8%BE%93%E5%87%BA%E6%8E%92%E9%98%9F"><span class="nav-text">4.2.4.2   输出排队</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-5-%E5%88%86%E7%BB%84%E8%B0%83%E5%BA%A6"><span class="nav-text">4.2.5   分组调度</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-5-1-%E5%85%88%E8%BF%9B%E5%85%88%E5%87%BA"><span class="nav-text">4.2.5.1   先进先出</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-5-2-%E4%BC%98%E5%85%88%E6%9D%83%E6%8E%92%E9%98%9F"><span class="nav-text">4.2.5.2   优先权排队</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-5-3-%E5%BE%AA%E7%8E%AF%E5%92%8C%E5%8A%A0%E6%9D%83%E5%85%AC%E5%B9%B3%E6%8E%92%E9%98%9F"><span class="nav-text">4.2.5.3   循环和加权公平排队</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3-%E7%BD%91%E9%99%85%E5%8D%8F%E8%AE%AE%EF%BC%9AIPv4%E3%80%81%E5%AF%BB%E5%9D%80%E3%80%81IPv6%E5%8F%8A%E5%85%B6%E4%BB%96"><span class="nav-text">4.3   网际协议：IPv4、寻址、IPv6及其他</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-1-IPv4%E6%95%B0%E6%8D%AE%E6%8A%A5%E6%A0%BC%E5%BC%8F"><span class="nav-text">4.3.1   IPv4数据报格式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-2-IPv4%E6%95%B0%E6%8D%AE%E6%8A%A5%E5%88%86%E7%89%87"><span class="nav-text">4.3.2   IPv4数据报分片</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-3-IPv4%E7%BC%96%E5%9D%80"><span class="nav-text">4.3.3   IPv4编址</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-3-1-%E8%8E%B7%E5%8F%96%E7%BB%84%E7%BB%87%E5%9C%B0%E5%9D%80%E5%9D%97"><span class="nav-text">4.3.3.1   获取组织地址块</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-3-2-%E8%8E%B7%E5%8F%96%E4%B8%BB%E6%9C%BA%E5%9C%B0%E5%9D%80%EF%BC%9A%E5%8A%A8%E6%80%81%E4%B8%BB%E6%9C%BA%E9%85%8D%E7%BD%AE%E5%8D%8F%E8%AE%AE"><span class="nav-text">4.3.3.2   获取主机地址：动态主机配置协议</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-4-%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2"><span class="nav-text">4.3.4   网络地址转换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-5-IPv6"><span class="nav-text">4.3.5   IPv6</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-5-1-IPv6%E6%95%B0%E6%8D%AE%E6%8A%A5%E6%A0%BC%E5%BC%8F"><span class="nav-text">4.3.5.1   IPv6数据报格式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-5-2-%E4%BB%8EIPv4%E5%88%B0IPv6%E7%9A%84%E8%BF%81%E7%A7%BB"><span class="nav-text">4.3.5.2   从IPv4到IPv6的迁移</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-4-%E9%80%9A%E7%94%A8%E8%BD%AC%E5%8F%91%E5%92%8CSDN"><span class="nav-text">4.4  通用转发和SDN</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-1-%E5%8C%B9%E9%85%8D"><span class="nav-text">4.4.1   匹配</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-2-%E5%8A%A8%E4%BD%9C"><span class="nav-text">4.4.2   动作</span></a></li></ol></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>



<script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/dark-light-toggle.js"></script>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/local-search.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/code-copy.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/lazyload.js"></script>


<div class="post-scripts pjax">
    
        <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/left-side-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/libs/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/toc.js"></script>
    
</div>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/libs/pjax.min.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
